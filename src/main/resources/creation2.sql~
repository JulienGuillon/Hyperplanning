DROP TABLE IF EXISTS USERS CASCADE ;
DROP TABLE IF EXISTS VISITOR;
DROP TABLE IF EXISTS TEACHER CASCADE ;
DROP TABLE IF EXISTS STUDENT CASCADE;
DROP TABLE IF EXISTS MAINTENANCE_TECHNICIAN;
DROP TABLE IF EXISTS RESPONSABLE;
DROP TABLE IF EXISTS NETWORK_ENGINEER;
DROP TABLE IF EXISTS STUDENT_TEACHER;
DROP TABLE IF EXISTS STUDENT_TUTELAGE;
DROP TABLE IF EXISTS SPECIFIC_TEACHER;
DROP TABLE IF EXISTS DELEGATED_STUDENT;
DROP TABLE IF EXISTS COURSE CASCADE ;
DROP TABLE IF EXISTS ROOM;
DROP TABLE IF EXISTS BATIMENT;
DROP TABLE IF EXISTS PROMOTION CASCADE ;
DROP TABLE IF EXISTS GROUPE CASCADE ;
DROP TABLE IF EXISTS COURSEPROMOTION;


DROP DOMAIN IF EXISTS typePromotion;
DROP DOMAIN IF EXISTS Domaine;
DROP DOMAIN IF EXISTS Sexe;
DROP DOMAIN IF EXISTS Institut;
DROP DOMAIN IF EXISTS Statut;
DROP DOMAIN IF EXISTS Roles;
DROP DOMAIN IF EXISTS typeOfRoom;
DROP DOMAIN IF EXISTS typeCourse;

CREATE DOMAIN typeCourse AS VARCHAR
CHECK (
  VALUE IN ('TP', 'CM', 'TD')
);

CREATE DOMAIN typeOfRoom AS VARCHAR
CHECK (
  VALUE IN ('TP', 'Amphi', 'Gymnase', 'Stade', 'Chimie')
);

CREATE DOMAIN typePromotion AS VARCHAR
CHECK (
  VALUE IN ('L1', 'L2', 'L3', 'M1', 'M2', 'D1', 'D2')
);

CREATE DOMAIN Domaine AS VARCHAR
CHECK (
  VALUE IN ('SI', 'BIO','PC','MASS','LEA','ECO','SUAPS')
);


CREATE DOMAIN Statut AS VARCHAR
CHECK(
  VALUE IN ('HOLDER', 'EXTERNAL_TEACHER','RESEARCHER','PARTICIPANT')
);


CREATE DOMAIN Sexe AS VARCHAR
CHECK(
  VALUE IN ('MAN','WOMAN')
);


CREATE DOMAIN Roles AS VARCHAR
CHECK(
  VALUE IN ('STUDENT', 'TEACHER','MAINTENANCE_TECHNICIAN','RESPONSABLE','NETWORK_ENGINEER','STUDENT_TEACHER','SPECIFIC_TEACHER','DELEGATED_STUDENT','VISITOR','STUDENT_TUTELAGE')
);


CREATE DOMAIN Institut AS VARCHAR
CHECK(
  VALUE IN ('FAC','IUT')
);

CREATE TABLE USERS(
  nom VARCHAR(100),
  prenom VARCHAR(100),
  role Roles,
  login VARCHAR(100),
  password VARCHAR(100),
  PRIMARY KEY(login)
);


CREATE TABLE TEACHER(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  statut Statut NOT NULL,
  subject VARCHAR(100),
  PRIMARY KEY(login)
);

CREATE TABLE STUDENT(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  domaine Domaine NOT NULL,
  promotion typePromotion NOT NULL,
  institut Institut NOT NULL,
  PRIMARY KEY(login)
);


CREATE TABLE MAINTENANCE_TECHNICIAN(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  PRIMARY KEY(login)
);

CREATE TABLE RESPONSABLE(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  PRIMARY KEY(login)
);

CREATE TABLE NETWORK_ENGINEER(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  PRIMARY KEY(login)
);

CREATE TABLE STUDENT_TEACHER(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  suject VARCHAR(100) NOT NULL,
  PRIMARY KEY(login)
);

CREATE TABLE STUDENT_TUTELAGE(
  login VARCHAR(100) REFERENCES USERS(login) UNIQUE,
  tutelage VARCHAR(100),
  PRIMARY KEY(login)
);

CREATE TABLE SPECIFIC_TEACHER(
  login VARCHAR(100) REFERENCES TEACHER(login) UNIQUE,
  subject VARCHAR(100),
  PRIMARY KEY(login)
);

CREATE TABLE DELEGATED_STUDENT(
  login VARCHAR(100) REFERENCES STUDENT(login) UNIQUE,
  PRIMARY KEY(login)
);

CREATE TABLE BATIMENT(
  batiment VARCHAR(100),
  domaineBatiment Domaine,
  PRIMARY KEY (batiment)
);

CREATE TABLE ROOM(
  idRoom SERIAL,
  batiment VARCHAR(100) REFERENCES BATIMENT(batiment),
  numRoom INTEGER,
  typeRoom typeOfRoom,
  capacity INTEGER,
  PRIMARY KEY (idRoom)
);

CREATE TABLE COURSE(
  idCourse SERIAL,
  typeCourse typeCourse,
  hour INTEGER,
  day INTEGER,
  idweek INTEGER,
  month INTEGER,
  subject VARCHAR(100),
  duree INTEGER,
  teacher VARCHAR REFERENCES TEACHER(login) UNIQUE,
  idRoom INTEGER REFERENCES ROOM(idRoom) UNIQUE,
  PRIMARY KEY (idCourse)
);

CREATE TABLE PROMOTION(
  idPromotion SERIAL,
  typePromotion typePromotion,
  domainePromotion Domaine,
  anneePromotion INTEGER,
  nombreInscrit INTEGER,
  PRIMARY KEY (idPromotion)
);

CREATE TABLE GROUPE(
  idGroup SERIAL,
  idPromotion INTEGER REFERENCES PROMOTION(idPromotion) UNIQUE,
  numGroup INTEGER,
  nombreParticipant INTEGER,
  PRIMARY KEY (idGroup)
);

CREATE TABLE CoursePromotion(
  idCoursePromotion INTEGER REFERENCES COURSE(idCourse) UNIQUE,
  idPromotion INTEGER REFERENCES PROMOTION(idPromotion) UNIQUE,
  PRIMARY KEY(idCoursePromotion, idPromotion)
);


INSERT INTO PROMOTION(typePromotion, domainePromotion, anneePromotion, nombreInscrit) VALUES ('M1', 'SI', 2015, 200);
INSERT INTO PROMOTION(typePromotion, domainePromotion, anneePromotion, nombreInscrit) VALUES ('L1', 'BIO', 2015, 200);
INSERT INTO PROMOTION(typePromotion, domainePromotion, anneePromotion, nombreInscrit) VALUES ('L1', 'SI', 2015, 200);
INSERT INTO PROMOTION(typePromotion, domainePromotion, anneePromotion, nombreInscrit) VALUES ('L2', 'SI', 2015, 200);

INSERT INTO BATIMENT VALUES ('A', 'SI');
INSERT INTO BATIMENT VALUES ('B', 'SI');
INSERT INTO BATIMENT VALUES ('C', 'BIO');

INSERT INTO ROOM(batiment, numRoom, typeRoom, capacity) VALUES ('A', 1, 'TP', 30);
INSERT INTO ROOM(batiment, numRoom, typeRoom, capacity)  VALUES ('A', 2, 'TP', 30);
INSERT INTO ROOM(batiment, numRoom, typeRoom, capacity)  VALUES ('B',1, 'Amphi', 100);
INSERT INTO ROOM(batiment, numRoom, typeRoom, capacity)  VALUES ('B', 2, 'TP', 30);

INSERT INTO USERS VALUES ('Guillon', 'julien','TEACHER','jguillon725','$2a$12$e8r2pbPJe/Dze7Hs1Ot88eCHmQlyGtxAE3zPpGTI909lX5OVOdbKC');

INSERT INTO TEACHER VALUES ('jguillon725', 'HOLDER', 'math');

INSERT INTO COURSE(typeCourse, hour, day, idweek, month, subject, duree, teacher, idRoom) VALUES ('CM', 8, 19, 43, 10, 'MATH', 1, 'jguillon725', 2);

INSERT INTO CoursePromotion VALUES (1, 1);


INSERT INTO USERS VALUES ('Caltot' ,'STUDENT','scaltot904' ,'$2a$12$s38Hy62mBB8ALtkFgD41uO0TgBSw7OjvotU/mOJTD0YGwDtIdQnl.');
INSERT INTO USERS VALUES ('Prevot','MAINTENANCE_TECHNICIAN','prevot','prevot');
INSERT INTO USERS VALUES ('Pesnel','DELEGATED_STUDENT','mpesnel','pesnel');
INSERT INTO USERS VALUES ('Lebret','SPECIFIC_TEACHER','lebret69','XXXX');
INSERT INTO USERS VALUES ('Cauty','STUDENT_TUTELAGE','cauty','cauty');
INSERT INTO USERS VALUES ('Farge','STUDENT_TEACHER','farge','farge');
INSERT INTO USERS VALUES ('Guard','NETWORK_ENGINEER','guard','guard');
INSERT INTO USERS VALUES ('Betz','RESPONSABLE','betz','betz');




INSERT INTO VISITOR VALUES ('Martinez','VISITOR');




INSERT INTO STUDENT VALUES ('Caltot' ,'STUDENT','scaltot904' ,'$2a$12$s38Hy62mBB8ALtkFgD41uO0TgBSw7OjvotU/mOJTD0YGwDtIdQnl.','SI','M1','FAC');
INSERT INTO STUDENT VALUES ('Cauty','STUDENT_TUTELAGE','cauty','cauty','SI','M1','FAC');

INSERT INTO TEACHER VALUES ('Guillon','TEACHER','jguillon725','$2a$12$e8r2pbPJe/Dze7Hs1Ot88eCHmQlyGtxAE3zPpGTI909lX5OVOdbKC'
,'HOLDER','math');
INSERT INTO TEACHER VALUES ('Farge','STUDENT_TEACHER','farge','farge','PARTICIPANT','java');
INSERT INTO TEACHER VALUES ('Lebret','SPECIFIC_TEACHER','lebret69','XXXX','HOLDER','sport');

INSERT INTO MAINTENANCE_TECHNICIAN VALUES ('Prevot','MAINTENANCE_TECHNICIAN','prevot','prevot');

INSERT INTO RESPONSABLE VALUES ('Betz','RESPONSABLE','betz','betz');

INSERT INTO NETWORK_ENGINEER VALUES ('Guard','NETWORK_ENGINEER','guard','guard');

INSERT INTO STUDENT_TEACHER VALUES ('Farge','STUDENT_TEACHER','farge','farge','Java');

INSERT INTO SPECIFIC_TEACHER VALUES ('Lebret','SPECIFIC_TEACHER','lebret69','XXXX','sport');

INSERT INTO STUDENT_TUTELAGE VALUES ('Cauty','STUDENT_TUTELAGE','cauty','cauty','english');


